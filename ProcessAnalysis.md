# Análisis de procesos en memoria

## Búsqueda de procesos maliciosos

Para buscar procesos maliciosos podemos utilizar el parámetro **malfind** de volatility, que volcará la información en el directorio que le indiquemos

volatility -f fichero_memoria **malfind -D malfind**

## Análisis de procesos maliciosos

Una vez localicemos los procesos maliciosos podemos obtener más información si utilizamos el parámetro **handles**, podemos limitar la salida a una serie de objetos, por ejemplo:  
**Key:** se refiere a un objeto del registro de Windows, que almacena información de configuración y preferencias del sistema y de las aplicaciones.  
**Mutant:** se refiere a un objeto de sincronización del sistema que se utiliza para garantizar que solo un proceso tenga acceso a un recurso compartido en un momento dado.  
**File:** se refiere a un objeto de archivo, que puede estar abierto por uno o varios procesos en el sistema.  
**Event:** se refiere a un objeto de sincronización del sistema que se utiliza para señalar que se ha producido un evento en el sistema.  

volatility -f fichero_memoria **handles -p[PID] -t Key,Mutant,File,Event**

## Persistencia

La persistencia suele ser muy importante a la hora de analizar malware, algunos malwares pueden modificar las claves de registro para así iniciarse automáticamente.  
La clave de registro **"Microsoft\Windows\CurrentVersion\Run"** es una ubicación en el registro de Windows que se utiliza para almacenar una lista de programas que se ejecutan automáticamente cada vez que se inicia el sistema operativo.  
Estos programas se inician automáticamente en segundo plano, sin la intervención del usuario.  

volatility -f fichero_memoria **printkey -K "Microsoft\Windows\CurrentVersion\Run"**

## Generación de línea temporal

Para crear una línea temporal de lo sucedido, usaremos los plugins de volatility:  
**timeliner:** se utiliza para crear una línea de tiempo de actividad del sistema operativo. La línea de tiempo muestra una lista de eventos relevantes que se han registrado en el sistema, junto con la fecha y hora en que ocurrieron.  
**Mftparser:** se utiliza para analizar el archivo de tabla de archivos maestros (MFT) de un sistema de archivos NTFS. El MFT es una base de datos que contiene información sobre cada archivo y carpeta en un volumen NTFS.  
**Shellbags:** se utiliza para analizar la información de "Shellbags" de un usuario. Los Shellbags son registros en el registro de Windows que contienen información sobre la forma en que se mostraron las carpetas en el Explorador de Windows, como el tamaño y la ubicación de la ventana, la posición de la barra de desplazamiento y el orden de visualización de los archivos.  

### Timeliner
volatility -f fichero_memoria **timeliner --output-file=timeline/timeliner.txt --output=body**
### Mftparser
volatility -f fichero_memoria **mftparser --output-file=timeline/mftparser.txt --output=body**
### Shellbags
volatility -f fichero_memoria **shellbags --output-file=timeline/shellbags.txt --output=body**

Esto nos dejará 3 ficheros independientes en el directorio timeline que posteriormente podremos unir y analizar con **mactime**


